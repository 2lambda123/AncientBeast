"use strict";(self.webpackChunkancientbeast=self.webpackChunkancientbeast||[]).push([[770],{67770:(e,t,r)=>{r.r(t),r.d(t,{default:()=>g});var a=r(4942),i=r(19755),n=r(16255),s=r(83355),c=r(23315),o=r(67790),h=(r(18394),r(71956)),u=r(56865);function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const g=function(e){e.abilities[40]=[{trigger:"onEndPhase",require:function(){return!0},activate:function(){var t=this,r=new h.Q(this.title,this.creature,this.creature,"",{alterations:{moveable:!1},deleteTrigger:"onStartPhase",turnLifetime:1},e),a=new h.Q("",this.creature,this.creature,"onUnderAttack",{effectFn:function(){return t._activateOnAttacker.apply(t,arguments)},deleteTrigger:"onStartPhase",turnLifetime:1},e);this.creature.addEffect(r),this.creature.addEffect(a)},_activateOnAttacker:function(t,r){if(void 0===r||!r.melee||r.isFromTrap)return!1;var a={alterations:{moveable:!1},deleteTrigger:"onEndPhase",turnLifetime:1,creationTurn:e.turn-1,deleteOnOwnerDeath:!0,stackable:!1};this.isUpgraded()&&(a.alterations.reqEnergy=5);var i=new h.Q(this.title,this.creature,r.attacker,"",a,e);r.attacker.addEffect(i,"%CreatureName".concat(i.target.id,"% has been grasped by tentacles")),r.attacker===e.activeCreature&&r.attacker.queryMove()}},{trigger:"onQuery",_targetTeam:s.S.Enemy,require:function(){return!!this.testRequirements()&&!!this.atLeastOneTarget(this.creature.getHexMap(c.y7),{team:this._targetTeam})},query:function(){var t=this;if(this.isUpgraded()){var r=[this.creature.getHexMap(c.Pf),this.creature.getHexMap(c._x)];e.grid.queryChoice({fnOnSelect:function(t,r){e.activeCreature.faceHex(r.hex,void 0,!0),r.hex.overlayVisualState("creature selected player"+e.activeCreature.team)},fnOnConfirm:function(){t.animation.apply(t,arguments)},team:this._targetTeam,id:this.creature.id,choices:r})}else e.grid.queryCreature({fnOnConfirm:function(){t.animation.apply(t,arguments)},team:this._targetTeam,id:this.creature.id,flipped:this.creature.flipped,hexes:this.creature.getHexMap(c.y7)})},activate:function(t,r){if(this.end(),e.Phaser.camera.shake(.02,100,!0,e.Phaser.camera.SHAKE_VERTICAL,!0),this.isUpgraded()){var a,i=0===r.choiceIndex,n=t.map((function(e){return e.y})),c=Math.min.apply(null,n),o=Math.max.apply(null,n);a=i?r.hex.y!==o:r.hex.y===c,t.sort((function(e,t){return a?e.y-t.y:t.y-e.y}));for(var h=0;h<t.length;h++){var u=t[h].creature;u&&(0,s.H)(this.creature,u,this._targetTeam)&&this._activateOnTarget(u)}}else this._activateOnTarget(t)},_activateOnTarget:function(t){var r=this,a=new h.Q("Hammered",this.creature,t,"onStepOut",{effectFn:function(t){var a=this;this.game.signals.creature.add((function i(s,c){"movementComplete"===s&&c.creature.id===t.target.id&&(a.game.signals.creature.remove(i),t.target.takeDamage(new n.h(t.owner,{pierce:r.damages.pierce},1,[],e)),t.deleteEffect())}))}},e),i=new n.h(this.creature,this.damages,1,[a],e);t.takeDamage(i)}},{trigger:"onQuery",_directions:[0,1,0,0,1,0],_targetTeam:s.S.Enemy,_maxPushDistance:1,_damagePerHexTravelled:1,require:function(){return!!this.testRequirements()&&!!this.testDirection({team:this._targetTeam,directions:this._directions})},query:function(){var t=this,r={fnOnConfirm:function(){t.animation.apply(t,arguments)},team:this._targetTeam,requireCreature:!0,stopOnCreature:!0,id:this.creature.id,sourceCreature:this.creature,x:this.creature.x,y:this.creature.y,directions:this._directions,dashedHexesAfterCreatureStop:!1};this.isUpgraded()?(r=e.grid.getDirectionChoices(f(f({},r),{},{dashedHexesAfterCreatureStop:!0,dashedHexesDistance:this._maxPushDistance})),e.grid.queryChoice(f(f({},r),{},{requireCreature:!1}))):e.grid.queryDirection(r)},activate:function(t,r,a){var i,n,s,c=this,h=this.creature;c.end();for(var d=(null==a||null===(i=a.queryOptions)||void 0===i?void 0:i.hexesDashed)||[],f=0;f<t.length;f++)if(t[f].creature){s=t[f].creature,n=t.slice(0,f);break}if(n.length>0){var g=o.Z$(n);r.direction===u.N.Left&&(g=e.grid.hexes[g.y][g.x+h.size-1]),e.grid.cleanReachable();var l=h.player.flipped&&r.direction===u.N.Right||r.direction===u.N.Left;h.moveTo(g,{overrideSpeed:100,ignoreMovementPoint:!0,turnAroundOnComplete:!l,callback:function(){c._damage(s,n),e.Phaser.camera.shake(.01,250,!0,e.Phaser.camera.SHAKE_HORIZONTAL,!0);var t=setInterval((function(){e.freezedInput||(clearInterval(t),c.isUpgraded()?c._pushTarget(s,d,r):e.activeCreature.queryMove())}),100)}})}else c._damage(s,n),c.isUpgraded()&&c._pushTarget(s,d,r)},_damage:function(t,r){var a={pierce:this.damages.pierce+r.length*this._damagePerHexTravelled},i=new n.h(this.creature,a,1,[],e);t.takeDamage(i)},_pushTarget:function(t,r,a){var i=this.creature;if(r.length)if(r.length>this._maxPushDistance)console.warn("Attempting to push target more (".concat(r.length,") than the supported distance (").concat(this._maxPushDistance,")"));else{var n=i.getHexMap(c.dU,this.isTargetingBackwards(a.direction)),s=r.slice();o.B0(s,!1,!1,i.id),o.B0(s,!1,!1,t.id);var h=n[0],d=s[0];a.direction===u.N.Left&&(h=h&&e.grid.hexes[h.y][h.x+i.size-1],d=d&&e.grid.hexes[d.y][d.x+t.size-1]),this._pushMove(h,t,d)}},_pushMove:function(t,r,a){var n=this.creature,s=setInterval((function(){e.freezedInput||(clearInterval(s),e.activeCreature.queryMove())}),100);if(!(n.dead||r&&r.dead||!n.stats.moveable||r&&!r.stats.moveable)){var c={overrideSpeed:500,ignorePath:!0,ignoreMovementPoint:!0,turnAroundOnComplete:!1};a&&r.moveTo(a,i.extend({animation:"push"},c)),n.moveTo(t,c)}}},{trigger:"onQuery",_targetTeam:s.S.Enemy,require:function(){var e=this;return!!this.testRequirements()&&!!this.atLeastOneTarget(this.creature.getHexMap(c.tE),{team:this._targetTeam,optTest:function(t){return!!e.isUpgraded()||t.size<=2}})},query:function(){var t=this;e.grid.queryCreature({fnOnConfirm:function(){t.animation.apply(t,arguments)},team:this._targetTeam,id:this.creature.id,flipped:this.creature.flipped,hexes:this.creature.getHexMap(c.tE),optTest:function(e){return!!t.isUpgraded()||e.size<=2}})},activate:function(t){var r=this,a=r.creature;r.end(),e.Phaser.camera.shake(.02,200,!0,e.Phaser.camera.SHAKE_BOTH,!0);var i=new n.h(a,r.damages,1,[],e),s=c.dU,o=e.grid.getHexMap(a.x-s.origin[0],a.y-s.origin[1],0,!1,s)[0].creature==t,h=t.x+(o?0:a.size-t.size);a.moveTo(e.grid.hexes[t.y][h],{ignorePath:!0,ignoreMovementPoint:!0,callback:function(){a.updateHex(),a.queryMove()}});var u=a.x+(o?t.size-a.size:0);t.moveTo(e.grid.hexes[a.y][u],{ignorePath:!0,ignoreMovementPoint:!0,callback:function(){t.updateHex(),t.takeDamage(i)}})}}]}},71956:(e,t,r)=>{r.d(t,{Q:()=>i});var a=r(18394);class i{constructor(e,t,r,a,i,n){this.effectFn=()=>{},this.requireFn=e=>!0,this.alterations={},this.turnLifetime=0,this.deleteTrigger="onStartOfRound",this.stackable=!0,this.specialHint=void 0,this.deleteOnOwnerDeath=!1,this.attacker=void 0,this.noLog=!1,this.id=n.effectId++,this.game=n,this.name=e,this.owner=t,this.target=r,this.trigger=a,this.creationTurn=n.turn;for(const e of Object.keys(i))e in this&&(this[e]=i[e]);n.effects.push(this)}animation(...e){e?this.activate(...e):this.activate()}activate(e){if(!this.requireFn(e))return!1;this.noLog||console.log("Effect "+this.name+" triggered"),e instanceof a.j&&e.addEffect(this),this.effectFn(this,e)}deleteEffect(){if("effects"in this.target){const e=this.target.effects.indexOf(this);this.target.effects[e]?this.target.effects.splice(e,1):console.warn("Failed to find effect on target.",this)}const e=this.game.effects.indexOf(this);this.game.effects[e]?this.game.effects.splice(e,1):console.warn("Failed to find effect on game.",this),"updateAlteration"in this.target&&this.target.updateAlteration()}}}}]);