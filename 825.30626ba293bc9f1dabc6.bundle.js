"use strict";(self.webpackChunkancientbeast=self.webpackChunkancientbeast||[]).push([[825],{68825:(e,t,r)=>{r.r(t),r.d(t,{default:()=>m});var i=r(4942),a=r(70885),s=r(42982),n=r(21094),c=r(83355),o=r(69394),h=r(67790),u=r(71956),f=r(78009);function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,i.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const m=function(e){e.abilities[6]=[{trigger:"onCreatureSummon onOtherCreatureSummon onOtherCreatureDeath",_buff:0,require:function(){if(this.creature.dead||this.creature.temp)return!1;var t=0;return e.creatures.forEach((function(e){"S"!=e.realm||e.dead||e.temp||(t+=2)})),t!=this._buff&&(this._buff=t,!0)},activate:function(){this.creature.facePlayerDefault();var t=0;this.isUpgraded()&&(t=this._buff),this.creature.replaceEffect(new u.Q("Lamellar Body",this.creature,this.creature,"",{alterations:{defense:this._buff,frost:this._buff,regrowth:t},stackable:!1},e))}},{trigger:"onQuery",_directions:[0,1,0,0,1,0],_targetTeam:c.S.Enemy,_executeHealthThreshold:49,require:function(){if(!this.testRequirements())return!1;if(!this.atLeastOneTarget(this._getHexes(),{team:this._targetTeam})){if(!this.isUpgraded())return!1;if(!this.testDirection({team:this._targetTeam,directions:this._directions,distance:this.creature.remainingMove+1,sourceCreature:this.creature}))return!1}return!0},query:function(){var t=this,r=this.creature,i={fnOnConfirm:function(){t.animation.apply(t,arguments)},flipped:r.player.flipped,id:r.id,team:c.S.Enemy,requireCreature:!0};if(i.choices=this._getHexes().map((function(e){return[e]})),this.isUpgraded()){var a=e.grid.getDirectionChoices({flipped:r.player.flipped,team:this._targetTeam,requireCreature:!0,stopOnCreature:!0,sourceCreature:r,id:r.id,x:r.x,y:r.y,directions:this._directions,distance:r.remainingMove+1});i.choices=i.choices.filter((function(e){return!a.choices.some((function(t){return e.every((function(e){return t.includes(e)}))}))})),i.choices=[].concat((0,s.Z)(i.choices),(0,s.Z)(a.choices))}e.grid.queryChoice(i)},activate:function(t,r){var i=this,a=i.creature;e.Phaser.camera.shake(.02,333,!0,e.Phaser.camera.SHAKE_HORIZONTAL,!0),i.end(),t=h.n(t,r.direction);var s=h.Z$(t).creature;if(this._getHexes().some((function(e){var t;return(null===(t=e.creature)||void 0===t?void 0:t.id)===s.id})))i._damageTarget(s);else{h.B0(t,!1,!0,a.id);var n=h.Z$(t),c=n.x+(4===r.direction?a.size-1:0);n=e.grid.hexes[n.y][c];var o=e.grid.getHexLine(s.x,s.y,r.direction);h.B0(o,!1,!0,s.id),o=o.slice(0,t.length),a.moveTo(n,{overrideSpeed:100,callback:function(){var t=h.Z$(o);i._damageTarget(s).kill||(t?(r.direction===f.N.Left&&(t=t&&e.grid.hexes[t.y][t.x+s.size-1]),s.moveTo(t,{callback:function(){e.activeCreature.queryMove()},ignoreMovementPoint:!0,ignorePath:!0,animation:"push"})):e.activeCreature.queryMove())}})}},_damageTarget:function(t){var r,i=t.health<=this._executeHealthThreshold&&t.isFrozen(),a=i?{pure:t.health}:{crush:this.damages.crush,frost:this.damages.frost},s=new n.h(this.creature,a,1,[],e);return i?(this.game.UI.chat.suppressMessage(/is dead/i,1),(r=t.takeDamage(s)).kill&&(this.game.log("%CreatureName".concat(t.id,"% has been shattered!")),t.hint("Shattered","damage"))):r=t.takeDamage(s),r},_getHexes:function(){return this.creature.getHexMap(o.LY)}},{trigger:"onQuery",_targetTeam:c.S.Enemy,_directions:[1,1,1,1,1,1],_distance:5,require:function(){return!!this.testRequirements()&&!!this.testDirection({sourceCreature:this.creature,team:this._targetTeam,directions:this._directions,distance:this._distance,optTest:this._confirmTarget})},query:function(){var t=this,r=this.creature;e.grid.queryDirection({fnOnConfirm:function(){t.animation.apply(t,arguments)},flipped:r.player.flipped,team:this._targetTeam,id:r.id,requireCreature:!0,x:r.x,y:r.y,directions:this._directions,distance:this._distance,optTest:this._confirmTarget})},activate:function(t,r){var i=this,s=this.creature,c=h.Z$(t).creature;i.end(),e.Phaser.camera.shake(.01,50,!0,e.Phaser.camera.SHAKE_HORIZONTAL,!0);var o=e.animations.projectile(this,c,"effects_freezing-spit",t,r,52,-20),u=(0,a.Z)(o,2),f=u[0],d=u[1],g=Math.max(s.stats.frost-c.stats.frost,0),m=new n.h(i.creature,{frost:g},1,[],e);f.onComplete.add((function(){var t;this.destroy(),m.damages.frost>0&&(t=c.takeDamage(m)),c.freeze(i.isUpgraded()),t&&!t.kill&&(e.log("%CreatureName".concat(c.id,"% ").concat(i.isUpgraded()?"enters Cryostasis":"has been Frozen"," and cannot act")),c.hint(i.isUpgraded()?"Cryostasis":"Frozen"))}),d)},_confirmTarget:function(e){return e.isFatigued()}},{trigger:"onQuery",_directions:[0,1,0,0,1,0],_targetTeam:c.S.Enemy,require:function(){return this.creature,!!this.testRequirements()&&!!this.atLeastOneTarget(this._getHexes(),{team:this._targetTeam})},query:function(){var e=this,t=this.creature;this.game.grid.queryCreature({fnOnConfirm:function(){e.animation.apply(e,arguments)},team:this._targetTeam,id:t.id,flipped:t.flipped,hexes:this._getHexes()})},activate:function(t){var r=this,i=this.creature;r.end(),e.Phaser.camera.shake(.02,123,!0,e.Phaser.camera.SHAKE_VERTICAL,!0);var a=Math.max(i.level-t.level,0),s=g(g({},r.damages),{},{frost:r.damages.frost+a*r.bonus_damages.frost,pierce:r.damages.pierce+(r.isUpgraded()?a*r.bonus_damages.pierce:0)}),c=new n.h(i,s,1,[],e);t.takeDamage(c)},_getHexes:function(){var t=this.creature;return[].concat((0,s.Z)(e.grid.getHexMap(t.x,t.y-4,2,!0,o.mA)),(0,s.Z)(this.creature.getHexMap(o.mA)))}}]}},71956:(e,t,r)=>{r.d(t,{Q:()=>a});var i=r(18394);class a{constructor(e,t,r,i,a,s){this.effectFn=()=>{},this.requireFn=e=>!0,this.alterations={},this.turnLifetime=0,this.deleteTrigger="onStartOfRound",this.stackable=!0,this.specialHint=void 0,this.deleteOnOwnerDeath=!1,this._trap=void 0,this.attacker=void 0,this.id=s.effectId++,this.game=s,this.name=e,this.owner=t,this.target=r,this.trigger=i,this.creationTurn=s.turn;for(const e of Object.keys(a))e in this&&(this[e]=a[e]);s.effects.push(this)}animation(...e){e?this.activate(...e):this.activate()}activate(e){if(!this.requireFn(e))return!1;e instanceof i.j&&e.addEffect(this),this.effectFn(this,e)}deleteEffect(){if("effects"in this.target){const e=this.target.effects.indexOf(this);this.target.effects[e]?this.target.effects.splice(e,1):console.warn("Failed to find effect on target.",this)}const e=this.game.effects.indexOf(this);this.game.effects[e]?this.game.effects.splice(e,1):console.warn("Failed to find effect on game.",this),"updateAlteration"in this.target&&this.target.updateAlteration()}get trap(){return this._trap}set trap(e){this._trap=e}}}}]);