"use strict";(self.webpackChunkancientbeast=self.webpackChunkancientbeast||[]).push([[535],{45535:(e,t,r)=>{r.r(t),r.d(t,{default:()=>g});var i=r(4942),a=r(40181);var n=r(42982),s=r(21094),o=r(83355),c=r(69394),u=r(67790),h=r(71956),f=r(78009);function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,i.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const g=function(e){e.abilities[6]=[{trigger:"onCreatureSummon onOtherCreatureSummon onOtherCreatureDeath",_buff:0,require:function(){if(this.creature.dead||this.creature.temp)return!1;var t=0;return e.creatures.forEach((function(e){"S"!=e.realm||e.dead||e.temp||(t+=2)})),t!=this._buff&&(this._buff=t,!0)},activate:function(){this.creature.facePlayerDefault();var t=0;this.isUpgraded()&&(t=this._buff),this.creature.replaceEffect(new h.Q("Lamellar Body",this.creature,this.creature,"",{alterations:{defense:this._buff,frost:this._buff,regrowth:t},stackable:!1},e))}},{trigger:"onQuery",_directions:[0,1,0,0,1,0],_targetTeam:o.S.Enemy,_executeHealthThreshold:49,require:function(){if(!this.testRequirements())return!1;if(!this.atLeastOneTarget(this._getHexes(),{team:this._targetTeam})){if(!this.isUpgraded())return!1;if(!this.testDirection({team:this._targetTeam,directions:this._directions,distance:this.creature.remainingMove+1,sourceCreature:this.creature}))return!1}return!0},query:function(){var t=this,r=this.creature,i={fnOnConfirm:function(){t.animation.apply(t,arguments)},flipped:r.player.flipped,id:r.id,team:o.S.Enemy,requireCreature:!0};if(i.choices=this._getHexes().map((function(e){return[e]})),this.isUpgraded()){var a=e.grid.getDirectionChoices({flipped:r.player.flipped,team:this._targetTeam,requireCreature:!0,stopOnCreature:!0,sourceCreature:r,id:r.id,x:r.x,y:r.y,directions:this._directions,distance:r.remainingMove+1});i.choices=i.choices.filter((function(e){return!a.choices.some((function(t){return e.every((function(e){return t.includes(e)}))}))})),i.choices=[].concat((0,n.Z)(i.choices),(0,n.Z)(a.choices))}e.grid.queryChoice(i)},activate:function(t,r){var i=this,a=i.creature;e.Phaser.camera.shake(.02,333,!0,e.Phaser.camera.SHAKE_HORIZONTAL,!0),i.end(),t=u.n(t,r.direction);var n=u.Z$(t).creature,s=this._getHexes().some((function(e){var t;return(null===(t=e.creature)||void 0===t?void 0:t.id)===n.id}));if(s)i._damageTarget(n);else{u.B0(t,!1,!0,a.id);var o=u.Z$(t),c=o.x+(4===r.direction?a.size-1:0);o=e.grid.hexes[o.y][c];var h=e.grid.getHexLine(n.x,n.y,r.direction);u.B0(h,!1,!0,n.id),h=h.slice(0,t.length),a.moveTo(o,{overrideSpeed:100,callback:function(){var t=u.Z$(h);i._damageTarget(n).kill||(t?(r.direction===f.N.Left&&(t=t&&e.grid.hexes[t.y][t.x+n.size-1]),n.moveTo(t,{callback:function(){e.activeCreature.queryMove()},ignoreMovementPoint:!0,ignorePath:!0,animation:"push"})):e.activeCreature.queryMove())}})}},_damageTarget:function(t){var r,i=t.health<=this._executeHealthThreshold&&t.isFrozen(),a=i?{pure:t.health}:{crush:this.damages.crush,frost:this.damages.frost},n=new s.h(this.creature,a,1,[],e);return i?(this.game.UI.chat.suppressMessage(/is dead/i,1),(r=t.takeDamage(n)).kill&&(this.game.log("%CreatureName".concat(t.id,"% has been shattered!")),t.hint("Shattered","damage"))):r=t.takeDamage(n),r},_getHexes:function(){return this.creature.getHexMap(c.LY)}},{trigger:"onQuery",_targetTeam:o.S.Enemy,_directions:[1,1,1,1,1,1],_distance:5,require:function(){return!!this.testRequirements()&&!!this.testDirection({sourceCreature:this.creature,team:this._targetTeam,directions:this._directions,distance:this._distance,optTest:this._confirmTarget})},query:function(){var t=this,r=this.creature;e.grid.queryDirection({fnOnConfirm:function(){t.animation.apply(t,arguments)},flipped:r.player.flipped,team:this._targetTeam,id:r.id,requireCreature:!0,x:r.x,y:r.y,directions:this._directions,distance:this._distance,optTest:this._confirmTarget})},activate:function(t,r){var i=this,n=this.creature,o=u.Z$(t).creature;i.end(),e.Phaser.camera.shake(.01,50,!0,e.Phaser.camera.SHAKE_HORIZONTAL,!0);var c,h,f=(c=e.animations.projectile(this,o,"effects_freezing-spit",t,r,52,-20),h=2,function(e){if(Array.isArray(e))return e}(c)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var i,a,n,s,o=[],c=!0,u=!1;try{if(n=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(i=n.call(r)).done)&&(o.push(i.value),o.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return o}}(c,h)||(0,a.Z)(c,h)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),d=f[0],l=f[1],g=Math.max(n.stats.frost-o.stats.frost,0),m=new s.h(i.creature,{frost:g},1,[],e);d.onComplete.add((function(){var t;this.destroy(),m.damages.frost>0&&(t=o.takeDamage(m)),o.freeze(i.isUpgraded()),t&&!t.kill&&(e.log("%CreatureName".concat(o.id,"% ").concat(i.isUpgraded()?"enters Cryostasis":"has been Frozen"," and cannot act")),o.hint(i.isUpgraded()?"Cryostasis":"Frozen","damage"))}),l)},_confirmTarget:function(e){return e.isFatigued()}},{trigger:"onQuery",_directions:[0,1,0,0,1,0],_targetTeam:o.S.Enemy,require:function(){return this.creature,!!this.testRequirements()&&!!this.atLeastOneTarget(this._getHexes(),{team:this._targetTeam})},query:function(){var e=this,t=this.creature;this.game.grid.queryCreature({fnOnConfirm:function(){e.animation.apply(e,arguments)},team:this._targetTeam,id:t.id,flipped:t.flipped,hexes:this._getHexes()})},activate:function(t){var r=this,i=this.creature;r.end(),e.Phaser.camera.shake(.02,123,!0,e.Phaser.camera.SHAKE_VERTICAL,!0);var a=Math.max(i.level-t.level,0),n=l(l({},r.damages),{},{frost:r.damages.frost+a*r.bonus_damages.frost,pierce:r.damages.pierce+(r.isUpgraded()?a*r.bonus_damages.pierce:0)}),o=new s.h(i,n,1,[],e);t.takeDamage(o)},_getHexes:function(){var t=this.creature;return[].concat((0,n.Z)(e.grid.getHexMap(t.x,t.y-4,2,!0,c.mA)),(0,n.Z)(this.creature.getHexMap(c.mA)))}}]}},71956:(e,t,r)=>{r.d(t,{Q:()=>a});var i=r(18394);class a{constructor(e,t,r,i,a,n){this.effectFn=()=>{},this.requireFn=e=>!0,this.alterations={},this.turnLifetime=0,this.deleteTrigger="onStartOfRound",this.stackable=!0,this.specialHint=void 0,this.deleteOnOwnerDeath=!1,this._trap=void 0,this.attacker=void 0,this.id=n.effectId++,this.game=n,this.name=e,this.owner=t,this.target=r,this.trigger=i,this.creationTurn=n.turn;for(const e of Object.keys(a))e in this&&(this[e]=a[e]);n.effects.push(this)}animation(...e){e?this.activate(...e):this.activate()}activate(e){if(!this.requireFn(e))return!1;e instanceof i.j&&e.addEffect(this),this.effectFn(this,e)}deleteEffect(){if("effects"in this.target){const e=this.target.effects.indexOf(this);this.target.effects[e]?this.target.effects.splice(e,1):console.warn("Failed to find effect on target.",this)}const e=this.game.effects.indexOf(this);this.game.effects[e]?this.game.effects.splice(e,1):console.warn("Failed to find effect on game.",this),"updateAlteration"in this.target&&this.target.updateAlteration()}get trap(){return this._trap}set trap(e){this._trap=e}}},30907:(e,t,r)=>{function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}r.d(t,{Z:()=>i})},4942:(e,t,r)=>{r.d(t,{Z:()=>a});var i=r(72881);function a(e,t,r){return(t=(0,i.Z)(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},42982:(e,t,r)=>{r.d(t,{Z:()=>n});var i=r(30907),a=r(40181);function n(e){return function(e){if(Array.isArray(e))return(0,i.Z)(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||(0,a.Z)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},40181:(e,t,r)=>{r.d(t,{Z:()=>a});var i=r(30907);function a(e,t){if(e){if("string"==typeof e)return(0,i.Z)(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?(0,i.Z)(e,t):void 0}}}}]);