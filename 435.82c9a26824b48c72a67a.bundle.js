"use strict";(self.webpackChunkancientbeast=self.webpackChunkancientbeast||[]).push([[435],{9435:(e,t,a)=>{a.r(t),a.d(t,{default:()=>u});var r=a(19755),i=a(16255),n=a(83355),s=a(23315),h=a(67790),o=a(18394),c=a(68861);const u=function(e){e.abilities[5]=[{trigger:"onUnderAttack",require:function(){return!0},activate:function(t){if(void 0===t)return!1;if(!t.damages.shock)return!1;this.end();var a=Math.floor(t.damages.shock/4);t.damages.shock-=a;var r=a-(this.creature.stats.energy-this.creature.energy);return this.creature.recharge(a),this.isUpgraded()&&r>0&&this.creature.heal(r),e.log("%CreatureName"+this.creature.id+"% absorbs "+a+" shock damage into energy"),t}},{trigger:"onQuery",_targetTeam:n.S.Enemy,require:function(){return!!this.testRequirements()&&!!this.atLeastOneTarget(this._getHexes(),{team:this._targetTeam})},query:function(){var t=this,a=this.creature;e.grid.queryCreature({fnOnConfirm:function(){t.animation.apply(t,arguments)},team:this._targetTeam,id:a.id,flipped:a.flipped,hexes:this._getHexes()})},activate:function(t){var a=this;a.end(),e.Phaser.camera.shake(.01,120,!0,e.Phaser.camera.SHAKE_HORIZONTAL,!0);var n=r.extend({poison:0},a.damages1);this.isUpgraded()&&(n.poison=this.damages1.poison);var s=new i.h(a.creature,n,1,[],e),h=t.takeDamage(s);h.damages&&h.damages.total>0&&(this.creature.remainingMove=this.creature.stats.movement,e.log("%CreatureName"+this.creature.id+"%'s movement recharged"),e.activeCreature.queryMove())},_getHexes:function(){return e.grid.getHexMap(this.creature.x-3,this.creature.y-2,0,!1,s.LY)}},{trigger:"onQuery",_targetTeam:n.S.Enemy,require:function(){return!!this.atLeastOneTarget(this._getHexes(),{team:this._targetTeam})&&this.testRequirements()},query:function(){var t=this,a=this.creature;e.grid.queryCreature({fnOnConfirm:function(){t.animation.apply(t,arguments)},team:this._targetTeam,id:a.id,flipped:a.flipped,hexes:this._getHexes()})},activate:function(t){var a=this;this.end();var r=this.damages,n=this.isUpgraded()?0:1,s=this;t.addEffect(new c.Q(s.title,t,t,"onUnderAttack",{effectFn:function(e,a){a.applyDamage().total>=t.health&&t.hexagons.forEach((function(e){e.destroyTrap()}))}},e));var h=new c.Q(s.title,s.creature,this,"onStepOut",{effectFn:function(n){a.game.signals.creature.add((function s(h,o){"movementComplete"===h&&o.creature.id===n.target.id&&(a.game.signals.creature.remove(s),e.log("%CreatureName"+n.target.id+"% is hit by "+n.name),n.target.takeDamage(new i.h(n.owner,r,1,[],e),{isFromTrap:!0}),t.hexagons.forEach((function(e){e.destroyTrap()})),n.deleteEffect())}))}},e);t.hexagons.forEach((function(e){e.createTrap("poisonous-vine",[h],s.creature.player,{turnLifetime:n,fullTurnLifetime:!0,ownerCreature:s.creature,destroyOnActivate:!0,destroyAnimation:"shrinkDown"})}))},_getHexes:function(){var t=e.grid.hexes[this.creature.y][this.creature.x].adjacentHex(2);return h.kh(t,this.creature.size,e.grid)}},{trigger:"onQuery",_targetTeam:n.S.Both,require:function(){return!!this.testRequirements()&&!!this.atLeastOneTarget(this._getHexes(),{team:this._targetTeam})},query:function(){var t=this;e.grid.queryCreature({fnOnConfirm:function(){t.animation.apply(t,arguments)},team:this._targetTeam,id:this.creature.id,flipped:this.creature.flipped,hexes:this._getHexes()})},activate:function(t){var a=this,s=this;s.end();var h=[];h.push(t);for(var u=r.extend({},s.damages),f=function(){var t=h[g];a.isUpgraded()&&(0,n.H)(a.creature,t,n.S.Ally)&&t.addEffect(new c.Q(a.title,a.creature,t,"onUnderAttack",{effectFn:function(e,a){for(;;){var r=a.applyDamage();if(r.total<=0||a.damages.shock<=0||t.health<=1){a.damages={shock:0};break}if(!(r.total>=t.health))break;a.damages.shock--}},deleteTrigger:"onEndPhase",noLog:!0},e));var r=new i.h(s.creature,u,1,[],e);if(void 0===(u=t.takeDamage(r)).damages)return"break";if(u.kill)return"break";if(u.damages.total<=0)return"break";if(""!==u.damageObj.status)return"break";delete u.damages.total,u=u.damages;var f=s.getTargets(t.adjacentHexes(1,!0));if(0===(f=f.filter((function(e){return void 0!==e.hexesHit&&-1==h.indexOf(e.target)}))).length)return"break";for(var d={size:0,stats:{defense:-99999,shock:-99999}},m=0;m<f.length;m++)if(void 0!==f[m]){var l=f[m].target;l.stats.shock>d.stats.shock&&(l==s.creature&&1==f.length||l!=s.creature)&&(d=l)}if(!(d instanceof o.j))return"break";h.push(d),e.Phaser.camera.shake(.03,220,!0,e.Phaser.camera.SHAKE_HORIZONTAL,!0)},g=0;g<h.length&&"break"!==f();g++);},_getHexes:function(){return e.grid.getHexMap(this.creature.x-3,this.creature.y-2,0,!1,s.LY)}}]}},68861:(e,t,a)=>{a.d(t,{Q:()=>h});var r=a(15671),i=a(43144),n=a(19755),s=a(18394),h=function(){function e(t,a,i,s,h,o){(0,r.Z)(this,e),this.id=o.effectId++,this.game=o,this.name=t,this.owner=a,this.target=i,this.trigger=s,this.creationTurn=o.turn;var c=n.extend({requireFn:function(){return!0},effectFn:function(){},alterations:{},turnLifetime:0,deleteTrigger:"onStartOfRound",stackable:!0,noLog:!1,specialHint:void 0,deleteOnOwnerDeath:!1},h);n.extend(this,c),o.effects.push(this)}return(0,i.Z)(e,[{key:"animation",value:function(){this.activate.apply(this,arguments)}},{key:"activate",value:function(e){if(!this.requireFn(e))return!1;this.noLog||console.log("Effect "+this.name+" triggered"),e instanceof s.j&&e.addEffect(this),this.effectFn(this,e)}},{key:"deleteEffect",value:function(){var e=this.target.effects.indexOf(this);this.target.effects[e]?this.target.effects.splice(e,1):console.warn("Failed to find effect on target.",this);var t=this.game.effects.indexOf(this);this.game.effects[t]?this.game.effects.splice(t,1):console.warn("Failed to find effect on game.",this),this.target.updateAlteration()}}]),e}()}}]);